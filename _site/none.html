<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>none - PGL Docs</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>none | PGL Docs</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="none" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation for the PGL project." /> <meta property="og:description" content="Documentation for the PGL project." /> <link rel="canonical" href="http://localhost:4000/none" /> <meta property="og:url" content="http://localhost:4000/none" /> <meta property="og:site_name" content="PGL Docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="none" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation for the PGL project.","headline":"none","url":"http://localhost:4000/none"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> PGL Docs </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="http://localhost:4000/variables" class="nav-list-link">Variables</a></li><li class="nav-list-item"><a href="http://localhost:4000/connections" class="nav-list-link">Connections</a></li><li class="nav-list-item"><a href="http://localhost:4000/project" class="nav-list-link">Project</a></li><li class="nav-list-item"><a href="http://localhost:4000/pipelines" class="nav-list-link">Pipelines</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search PGL Docs" aria-label="Search PGL Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h2 id="do-something-with-the-below"> <a href="#do-something-with-the-below" class="anchor-heading" aria-labelledby="do-something-with-the-below"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Do something with the below </h2> <p>A PGL project is composed of a profile.yml file containing project level configuration, a connections.yml containing configuration relevent to destination database connections and any number of modular “pipelines”, short yaml snippets that define a source and destination for data to be extracted from and loaded to. These pipeliens can be executed via a CLI in a number of ways to make scheduling and executing jobs easy and intuitive.</p> <p>Before getting started make sure you are familiar with contributing to a Git Repo and understand environment variables and secret management. These are all important to have a good handle on because data extraction and loading involves sensetive credentials. Understanding cloud services is a considerable advantage as well, although pgl can run on local files if that is not available.</p> <h2 id="project-configuration"> <a href="#project-configuration" class="anchor-heading" aria-labelledby="project-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project configuration </h2> <p>Project.yml files are used to set up project level configuration as well as to set some global pipeline congiurations if applicable.</p> <p>Top level configurations in a project.yml file for setting up a pgl ingestion platform are:</p> <p><code class="language-plaintext highlighter-rouge">file_storage_mode</code><br /> <code class="language-plaintext highlighter-rouge">file_storage_bucket</code><br /> <code class="language-plaintext highlighter-rouge">file_storage_directory</code><br /> <code class="language-plaintext highlighter-rouge">secret_mode</code></p> <p><code class="language-plaintext highlighter-rouge">file_storage_mode</code> defines the type of storage platform that is to be used for the sourcefile repository. It can be s3 to store all the files ingested in a specific s3 bucket or local to store all ingested files in an accessable file system. blob storage should be added.</p> <p><code class="language-plaintext highlighter-rouge">file_storage_bucket</code> defines the bucket that all the files that are ingested are stored in. Depending on the infrastructure setup you are working with, it could be a good idea to pass this in as an environment variable if using a different one for development vs. production.</p> <p><code class="language-plaintext highlighter-rouge">file_storage_directory</code> defines the parent directory in the <code class="language-plaintext highlighter-rouge">file_storage_bucket</code> to store the files. Files will be given a prefix denoting where they came from and what type of file they are, but sometimes we would like to define a parent directory and not use the entire bucket just for the <code class="language-plaintext highlighter-rouge">file_repository</code>.</p> <p><code class="language-plaintext highlighter-rouge">secret_mode</code> defines the method that secrets are stored in. Default is to store secrets in environment variables but this will be extended to use common secret stores.</p> <h2 id="pipeline-configuration"> <a href="#pipeline-configuration" class="anchor-heading" aria-labelledby="pipeline-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pipeline Configuration </h2> <h2 id="pipeline"> <a href="#pipeline" class="anchor-heading" aria-labelledby="pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> pipeline </h2> <p>A pipeline represents a file that gets pulled in from some source and gets dumped to a specific table. They can send many versions of that file perhaps daily or monthly that all follow the same structure/format of the given source_file.</p> <p>A pipeline definition can be organized into any file / directory in the <code class="language-plaintext highlighter-rouge">pipelines</code> directory of the git repo. Note that if a series of pipelines share configuration settings it can be set in the project.yml file to avoid having to duplicate configuration settings. See the example for how to go about that.</p> <p>Configuration tags are still in flux but the required ones are below. Note that these can come from global settings in profile.yml so if a lot of sources share a <code class="language-plaintext highlighter-rouge">load_type</code>, it can be set in project.yml and the actual pipeline yml snippet does not need to specify the load type.</p> <p><code class="language-plaintext highlighter-rouge">source_type</code><br /> <code class="language-plaintext highlighter-rouge">source_path</code><br /> <code class="language-plaintext highlighter-rouge">format_definition</code><br /> <code class="language-plaintext highlighter-rouge">destination_table</code><br /> <code class="language-plaintext highlighter-rouge">source_regex_matches</code><br /> <code class="language-plaintext highlighter-rouge">load_type</code><br /> <code class="language-plaintext highlighter-rouge">delete_after_copy</code><br /> <code class="language-plaintext highlighter-rouge">do_not_redownload</code></p> <p><code class="language-plaintext highlighter-rouge">source_type</code> defines the type of source connection that the file lives on. s3, some local file storage system or an external sftp.</p> <p><code class="language-plaintext highlighter-rouge">source_path</code> defines what path in the source connection system to look for the file, whether it be an s3 prefix or a filepath.</p> <p><code class="language-plaintext highlighter-rouge">format_definition</code> defines the format for a given file. The value shold be a path within the <code class="language-plaintext highlighter-rouge">format_definitions</code> directory excluding the trailing <code class="language-plaintext highlighter-rouge">.yml</code>. More on the config of this file will come later.</p> <p><code class="language-plaintext highlighter-rouge">load_type</code> defines the method with which to load the file into the databse</p> <p><code class="language-plaintext highlighter-rouge">delete_after_copy</code> is a boolean that tells quafl if we want to delete the file on the source system after downloading it to our internal <code class="language-plaintext highlighter-rouge">sourcefile_repository</code></p> <p><code class="language-plaintext highlighter-rouge">do_not_redownload</code> is a boolean that tells quafl to ignore file names that have already been downloaded. For example if we do not <code class="language-plaintext highlighter-rouge">delete_after_copy</code> we want to have <code class="language-plaintext highlighter-rouge">do_not_redownload</code> be <code class="language-plaintext highlighter-rouge">true</code> to avoid downloading duplicate files from the source system</p> <p><code class="language-plaintext highlighter-rouge">destination_table</code> is the table name that this file will get loaded to. This is optional. The table will be created using the <code class="language-plaintext highlighter-rouge">name</code> as the table name if not specified.</p> <p><code class="language-plaintext highlighter-rouge">file_regex_pattern</code> is a list of regex patterns that will be used to match filenames found in the directory to this particular sourcefile. for example <code class="language-plaintext highlighter-rouge">filename_\d{6}.txt</code> will match <code class="language-plaintext highlighter-rouge">filename_202101.txt</code> and <code class="language-plaintext highlighter-rouge">filename_202202.txt</code>. so that we could load a file every month when the filenames have the date in them.</p> <h2 id="format_definitions"> <a href="#format_definitions" class="anchor-heading" aria-labelledby="format_definitions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> format_definitions </h2> <p>A <code class="language-plaintext highlighter-rouge">format_definition</code> is a configuration that specifies a specific format that a file comes in as. It should incldue the type of file (xlsx, delimited, etc.) as well as the schema (column names) and some additional optional params specifying things like “delimiter” or “quotechar” (quoting character)</p> <p>Each source_file is linked to a format_definition. These format_definitions can be custom to a source_file or can be some industry standard format that can be shared between different source_files.</p> <p>Specific configurations are still tbd</p> <h2 id="env-vars-and-secrets"> <a href="#env-vars-and-secrets" class="anchor-heading" aria-labelledby="env-vars-and-secrets"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Env Vars and Secrets </h2> <p>Configuration files are made in yaml with the ability to pass in secrets and environment variables for most settings via jinja templating</p> <p><code class="language-plaintext highlighter-rouge">""</code> <code class="language-plaintext highlighter-rouge">""</code> or if the secret is a json and we want a key from it like aws secret manager does <code class="language-plaintext highlighter-rouge">""</code></p> <p>values can also be passed in from the <code class="language-plaintext highlighter-rouge">profile.yml</code> in the <code class="language-plaintext highlighter-rouge">~/.pgl/</code> directory. with</p> <p><code class="language-plaintext highlighter-rouge">""</code></p> <h1 id="example"> <a href="#example" class="anchor-heading" aria-labelledby="example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example </h1> <h2 id="profileyml"> <a href="#profileyml" class="anchor-heading" aria-labelledby="profileyml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> profile.yml </h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># this means that all secrets are stored as environment variables
secret_mode: environment_variable
sourcefile_repository_mode: s3
# This comes from an environment variable
sourcefile_bucket: env::SOURCEFILE_REPO_BUCKET
# This comes from a secret
sourcefile_download_directory: secret::SOURCEFILE_REPO_DIRECTORY

# pipeline configuration
# pipeline yaml files are placed in any given directory in the pipeline directory
# they can be run at a directory level or file level

# the leading + means that we will add this tag to everything in the directory
# note that these tags can be overriden in the actual pipelines
pipelines:
  # defaults
  +do_not_redownload: false
  +delete_after_copy: false
  +load_type: "python_native"

  # use copy into for all weather pipelines
  # note that things specified here will overwrite the above configuration tags
  # so all the weather directory pipelines will default to "copy into" where as all
  # the other pipeliens will default to "python native"
  weather:
    +load_type: "copy_into"
    +source_type: "ftp"
</code></pre></div></div> <h2 id="pipeline-1"> <a href="#pipeline-1" class="anchor-heading" aria-labelledby="pipeline-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> pipeline </h2> <p>The name of the pipeline.yml file can be any valid filename and can hold however many pipelines as you would like. It is mainly an organizational preference. In the example they are grouped by cadence so it’s easy to see all the daily and all the monthly pipelines together.</p> <p>Pipelines are placed as a list under the <code class="language-plaintext highlighter-rouge">pipelines</code> tag. Below are 2 pipelines. Note that per the above project.yml, we are defaulting <code class="language-plaintext highlighter-rouge">load_type</code> and <code class="language-plaintext highlighter-rouge">source_type</code> so they dont need to be configured here. You can see that the “storm_events” has a <code class="language-plaintext highlighter-rouge">load_type</code> tag of <code class="language-plaintext highlighter-rouge">python_native</code> which means it will override the defaults set at the <code class="language-plaintext highlighter-rouge">profile.yml</code> file</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipelines:
  - name: storm_events
    description: &gt;
      National Centers for Environmental Information Storm data - events
    format_definition: ncdc/storm_details

    # overriding the global settings
    load_type: python_native

    # already set at profile.yml
    # source_type: ftp

    host: ftp.ncei.noaa.gov
    source_path: /pub/data/swdi/stormevents/csvfiles/
    destination_table: src_storm_events
    file_regex_patterns:
      - StormEvents_details-ftp_v1.0_d1976_c20210803.csv.gz
  - name: storm_fatalities
    description: &gt;
      National Centers for Environmental Information Storm data - fatalities
    format_definition: ncdc/storm_fatalities

    # already set at profile.yml
    # load_type: copy_into
    # source_type: ftp

    host: ftp.ncei.noaa.gov
    source_path: /pub/data/swdi/stormevents/csvfiles/
    destination_table: src_storm_fatalities
    file_regex_patterns:
      - StormEvents_fatalities-ftp_v1.0_d2011_c20220107.csv.gz
</code></pre></div></div> <h2 id="execution"> <a href="#execution" class="anchor-heading" aria-labelledby="execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Execution </h2> <p>The below 4 commands can be used to kick off pipeline ingestion executions</p> <p><code class="language-plaintext highlighter-rouge">pgl run</code> runs all pipelines<br /> <code class="language-plaintext highlighter-rouge">pgl run --pipelines weather</code> runs weather pipelines<br /> <code class="language-plaintext highlighter-rouge">pgl run --pipelines weather.ncdc_daily</code> runs daily weather pipelines<br /> <code class="language-plaintext highlighter-rouge">pgl run --pipelines weather.ndcc_daily.storm_events</code> runs only the storm event pipeline</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
